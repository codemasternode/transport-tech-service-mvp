{"version":3,"sources":["../../src/config/mailer.js"],"names":["EmailTemplate","require","fromEmail","process","env","EMAIL_ADDRESS_MAILER","transporter","start","nodemailer","createTransport","host","port","secure","auth","user","pass","PASSSWORD_MAILER","tls","rejectUnauthorized","verify","console","log","sendEmail","to","subject","html","text","Promise","resolve","reject","sendMail","err","info","loadTemplate","templateName","contexts","path","join","__dirname","template","all","map","context","render","result","email"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;AAEA;;;;;;;;AADA,IAAMA,aAAa,GAAGC,OAAO,CAAC,iBAAD,CAAP,CAA2BD,aAAjD;;AAGA,IAAME,SAAS,mDAA4CC,OAAO,CAACC,GAAR,CAAYC,oBAAxD,MAAf;AAEA,IAAIC,WAAJ;;SAEeC,K;;;;;;;0BAAf;AAAA;AAAA;AAAA;AAAA;AACED,YAAAA,WAAW,GAAGE,uBAAWC,eAAX,CAA2B;AACvCC,cAAAA,IAAI,EAAE,gBADiC;AAEvCC,cAAAA,IAAI,EAAE,GAFiC;AAGvCC,cAAAA,MAAM,EAAE,IAH+B;AAIvCC,cAAAA,IAAI,EAAE;AACJC,gBAAAA,IAAI,EAAEX,OAAO,CAACC,GAAR,CAAYC,oBADd;AAEJU,gBAAAA,IAAI,EAAEZ,OAAO,CAACC,GAAR,CAAYY;AAFd,eAJiC;AAQvCC,cAAAA,GAAG,EAAE;AACHC,gBAAAA,kBAAkB,EAAE;AADjB;AARkC,aAA3B,CAAd;AADF;AAAA;AAAA,mBAeUZ,WAAW,CAACa,MAAZ,EAfV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAiBIC,YAAAA,OAAO,CAACC,GAAR;;AAjBJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAqBAd,KAAK;;AAEE,SAASe,SAAT,OAAgD;AAAA,MAA3BC,EAA2B,QAA3BA,EAA2B;AAAA,MAAvBC,OAAuB,QAAvBA,OAAuB;AAAA,MAAdC,IAAc,QAAdA,IAAc;AAAA,MAARC,IAAQ,QAARA,IAAQ;AACrD,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCvB,IAAAA,WAAW,CAACwB,QAAZ,CACE;AACE5B,MAAAA,SAAS,EAATA,SADF;AAEEqB,MAAAA,EAAE,EAAFA,EAFF;AAGEC,MAAAA,OAAO,EAAPA,OAHF;AAIEC,MAAAA,IAAI,EAAJA,IAJF;AAKEC,MAAAA,IAAI,EAAJA;AALF,KADF,EAQE,UAACK,GAAD,EAAMC,IAAN,EAAe;AACb,UAAID,GAAJ,EAAS;AACPF,QAAAA,MAAM,CAACE,GAAD,CAAN;AACD;;AACDH,MAAAA,OAAO;AACR,KAbH;AAeD,GAhBM,CAAP;AAiBD;;AAEM,SAASK,YAAT,CAAsBC,YAAtB,EAAoCC,QAApC,EAA8C;AACnDf,EAAAA,OAAO,CAACC,GAAR,CACEe,iBAAKC,IAAL,CAAUC,SAAV,EAAqB,8BAArB,EAAqDJ,YAArD,CADF;AAGA,MAAIK,QAAQ,GAAG,IAAIvC,aAAJ,CACboC,iBAAKC,IAAL,CAAUC,SAAV,EAAqB,8BAArB,EAAqDJ,YAArD,CADa,CAAf;AAGA,SAAOP,OAAO,CAACa,GAAR,CACLL,QAAQ,CAACM,GAAT,CAAa,UAAAC,OAAO,EAAI;AACtB,WAAO,IAAIf,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCU,MAAAA,QAAQ,CAACI,MAAT,CAAgBD,OAAhB,EAAyB,UAACX,GAAD,EAAMa,MAAN,EAAiB;AACxCxB,QAAAA,OAAO,CAACC,GAAR,CAAYuB,MAAZ,EAAoB,EAApB;AACA,YAAIb,GAAJ,EAASF,MAAM,CAACE,GAAD,CAAN,CAAT,KAEEH,OAAO,CAAC;AACNiB,UAAAA,KAAK,EAAED,MADD;AAENF,UAAAA,OAAO,EAAPA;AAFM,SAAD,CAAP;AAIH,OARD;AASD,KAVM,CAAP;AAWD,GAZD,CADK,CAAP;AAeD","sourcesContent":["import nodemailer from \"nodemailer\";\nimport hbs from \"nodemailer-express-handlebars\";\nimport dotenv from \"dotenv/config\";\nconst EmailTemplate = require(\"email-templates\").EmailTemplate;\nimport path from \"path\";\n\nconst fromEmail = `transport-tech-service-notifications <${process.env.EMAIL_ADDRESS_MAILER}>`;\n\nlet transporter;\n\nasync function start() {\n  transporter = nodemailer.createTransport({\n    host: \"smtp.gmail.com\",\n    port: 465,\n    secure: true,\n    auth: {\n      user: process.env.EMAIL_ADDRESS_MAILER,\n      pass: process.env.PASSSWORD_MAILER\n    },\n    tls: {\n      rejectUnauthorized: false\n    }\n  });\n\n  try {\n    await transporter.verify();\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nstart();\n\nexport function sendEmail({ to, subject, html, text }) {\n  return new Promise((resolve, reject) => {\n    transporter.sendMail(\n      {\n        fromEmail,\n        to,\n        subject,\n        html,\n        text\n      },\n      (err, info) => {\n        if (err) {\n          reject(err);\n        }\n        resolve();\n      }\n    );\n  });\n}\n\nexport function loadTemplate(templateName, contexts) {\n  console.log(\n    path.join(__dirname, \"../emailsTemplates/templates\", templateName)\n  );\n  let template = new EmailTemplate(\n    path.join(__dirname, \"../emailsTemplates/templates\", templateName)\n  );\n  return Promise.all(\n    contexts.map(context => {\n      return new Promise((resolve, reject) => {\n        template.render(context, (err, result) => {\n          console.log(result, 65)\n          if (err) reject(err);\n          else\n            resolve({\n              email: result,\n              context\n            });\n        });\n      });\n    })\n  );\n}\n"],"file":"mailer.js"}